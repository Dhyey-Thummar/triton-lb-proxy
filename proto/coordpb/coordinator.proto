syntax = "proto3";

package coordpb;

option go_package = "triton-lb-proxy/proto/coordpb";

// Messages for proxy control (coordinator -> proxy)
message ModeRequest {
  string mode = 1; // "ACTIVE" or "IDLE"
  string coordinator_id = 2;
}
message ModeResponse {
  bool ok = 1;
  string message = 2;
}

// Messages for proxy -> coordinator notifications
message NotifyRequest {
  string server_id = 1;
  string desire = 2; // "WANT_ACTIVE" or "WANT_IDLE" or "ACTIVE" or "IDLE"
  double cpu_util = 3;
  int64 queue_len = 4;
}
message NotifyResponse {
  bool ok = 1;
  string message = 2;
}

// Coordinator â†’ Loadgen (pushes active server set)
message UpdateActiveServersRequest {
  repeated int32 server_indices = 1; // indices into the client's full server list
}

message UpdateActiveServersResponse {
  bool ok = 1;
  string message = 2;
}

// Loadgen implemented service
service LoadgenControl {
  rpc UpdateActiveServers(UpdateActiveServersRequest)
      returns (UpdateActiveServersResponse);
}

// Service implemented by each proxy so coordinator can call SetMode
service ProxyControl {
  rpc SetMode(ModeRequest) returns (ModeResponse);
}

// Service implemented by the coordinator so proxies can send notifications
service Coordinator {
  rpc NotifyState(NotifyRequest) returns (NotifyResponse);
}
