syntax = "proto3";

package coordpb;

option go_package = "triton-lb-proxy/proto/coordpb";

// Messages for proxy control (coordinator -> proxy)
message ModeRequest {
  string mode = 1; // "ACTIVE" or "IDLE" or "FAILOVER"
  string bounce_server_id = 2; // server to bounce to in case of FAILOVER
  string coordinator_id = 3;
}
message ModeResponse {
  bool ok = 1;
  string message = 2;
}

// Messages for proxy -> coordinator notifications
message NotifyRequest {
  string server_id = 1;
  string desire = 2; // "ACTIVE" or "IDLE"
  double cpu_util = 3;
  int64 queue_len = 4;
  string current_mode = 5; // "ACTIVE" or "IDLE" or "FAILOVER"
}
message NotifyResponse {
  bool ok = 1;
  string message = 2;
}

// Coordinator â†’ Loadgen (pushes active server set)
message UpdateActiveServersRequest {
  map<string, bool> server_active = 1;
}

message UpdateActiveServersResponse {
  bool ok = 1;
  string message = 2;
}

// Loadgen implemented service
service LoadgenControl {
  rpc UpdateActiveServers(UpdateActiveServersRequest)
      returns (UpdateActiveServersResponse);
}

// Service implemented by each proxy so coordinator can call SetMode
service ProxyControl {
  rpc SetMode(ModeRequest) returns (ModeResponse);
}

// Service implemented by the coordinator so proxies can send notifications
service Coordinator {
  rpc NotifyState(NotifyRequest) returns (NotifyResponse);
}
